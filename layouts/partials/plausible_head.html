{{- if site.Params.plausible }}
    <!-- Active plausible on/off + Front Matter option for each page -->
    {{- if and (site.Params.plausible.enable) (not .Params.plausible_do_not_track) }}
        <!-- To avoid stats bloat when in dev/server mode -->
        {{- if not site.IsServer -}}
            {{- if site.Params.plausible.custom_js_domain }}
                <!-- Script via custom domain -->
                <script async defer data-domain="{{ site.Params.plausible.domain }}" src="https://{{ site.Params.plausible.custom_js_domain }}/js/index.js"></script>
            {{- else }}
                <!-- Script direct -->
                <script async defer data-domain="{{ site.Params.plausible.domain }}" src="https://{{ default "plausible.io" site.Params.plausible.selfhosted_domain }}/js/plausible.js"></script>
            {{- end }}
        {{- end }}

        <!-- For custom goals/events -->
        <script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>

        <!-- Eventually write public URL information in Web page source -->
        {{- if site.Params.plausible.public_dashboard }}
            {{- $dashboard_url := default "plausible.io" site.Params.plausible.selfhosted_domain }}
            {{- $dashboard_url = printf "%s/%s" $dashboard_url site.Params.plausible.domain }}
            {{- printf "<!-- Plausible Analytics public dashboard URL : https://%s -->" $dashboard_url | safeHTML }}
        {{- end }}

        <!-- Create a unique script for all the onclick -->
        <script>
            {{- partial "plausible_js.html" . | safeJS }}
        </script>
    {{- end }}
{{- end }}
